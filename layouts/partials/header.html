<div id="img-back" class="img-back" style="background-image: none;"></div>

{{ $fence := resources.Get "img/fence.svg" }}

<div class="h-3/10-screen fence object-center" style="background-image: url('{{ $fence.Permalink }}')">
    <div class="h-full flex">
        <div class="grow"></div>
        <div class="shrink w-main">
            <div class="max-h-[60%] h-fit div-center overflow-y-auto scrollbar-thin scrollbar-thumb-gray-100/50 hover:scrollbar-thumb-gray-100/80">
                <div class="px-2 text-center text-gray-100 [text-shadow:_0.1rem_0.1rem_0.2rem_var(--tw-shadow-color)] shadow-gray-900">
                    <div id="board"></div>
                </div>
                <div style="display: none" id="board-display">{{ os.ReadFile "_index.md" | markdownify }}</div>
                <script>
                    $(document).ready(function () {
                        let boards = {}
                        let imgs = []
                        let img = ""
                        let start = false
                        $("#board-display").children().each(function () {
                            let html = $(this).prop("outerHTML")
                            if (html.includes("<h1") && html.includes("header")) {
                                start = true
                                return
                            }
                            if (start && html.includes("<h1")) {
                                start = false
                                return
                            }
                            if (!start) {
                                return
                            }
                            if (html.includes("<img")) {
                                img = html
                                imgs.push(img)
                                boards[img] = []
                            } else if (img !== "") {
                                boards[img].push(html)
                            }
                        })

                        let hit = new Date().getTime() % imgs.length
                        img = imgs[hit]
                        let board = ""
                        if (boards[img] != null && boards[img] !== undefined) {
                            board = boards[img].join("")
                        }
                        img = $(img).find("img").attr("src")

                        if (img !== "" && img !== null && img !== undefined) {
                            $("#img-back").css({"background-image": "url('" + img + "')"})
                        } else {
                            $("#img-back").css({"background-image": "url('https://bingw.jasonzeng.dev/?index=random')"})
                        }
                        if (board !== "" && board !== null && board !== undefined) {
                            $("#board").html(board)
                        } else {
                            $("#board").html("<h1>" + window.location.host + "</h1>")
                        }
                    })
                </script>
            </div>
        </div>
        <div class="grow"></div>
    </div>
</div>